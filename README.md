# üóÑÔ∏è Multi-Database Architecture

Uma arquitetura moderna e escal√°vel utilizando **PostgreSQL**, **MongoDB** e **Redis** para cobrir todas as necessidades de dados da aplica√ß√£o.

## üìã Vis√£o Geral

Esta implementa√ß√£o fornece uma solu√ß√£o completa de banco de dados com:

- **üêò PostgreSQL**: Dados relacionais, transa√ß√µes ACID, integridade referencial
- **üçÉ MongoDB**: Dados flex√≠veis, logs, analytics, documentos din√¢micos  
- **üî¥ Redis**: Cache, sess√µes, rate limiting, comunica√ß√£o real-time

## üöÄ In√≠cio R√°pido

### 1. Pr√©-requisitos

```bash
# Docker e Docker Compose
docker --version
docker-compose --version

# WSL (para Windows)
wsl --version
```

### 2. Inicializa√ß√£o Completa

```bash
# Clone e acesse o diret√≥rio
cd \\wsl.localhost\Ubuntu-20.04\home\app

# Torne o script execut√°vel
chmod +x manage_databases.sh

# Inicie toda a arquitetura
./manage_databases.sh start

# Inicialize com dados de exemplo
./manage_databases.sh init
```

### 3. Acesso √†s Interfaces

- **üêò Adminer (PostgreSQL)**: http://localhost:8080
- **üçÉ Mongo Express (MongoDB)**: http://localhost:8081  
- **üî¥ Redis Commander (Redis)**: http://localhost:8082
- **üìä Grafana (Monitoring)**: http://localhost:3000
- **üìà Prometheus (Metrics)**: http://localhost:9090

### 4. Credenciais Padr√£o

```
PostgreSQL:
- Host: localhost:5432
- Database: app_relational
- User: app_user
- Password: secure_password_here

MongoDB:
- Host: localhost:27017
- Database: app_flexible
- User: admin
- Password: secure_password_here

Redis:
- Host: localhost:6379
- Password: redis_password_here

Interfaces Web:
- Adminer: postgres/app_user/secure_password_here
- Mongo Express: admin/admin123
- Redis Commander: admin/admin123
- Grafana: admin/admin123
```

## üèóÔ∏è Estrutura de Dados

### PostgreSQL - Dados Relacionais

```sql
-- Estruturas principais
companies               -- Empresas
users                   -- Usu√°rios
user_profiles          -- Perfis de usu√°rio
company_users          -- Associa√ß√µes empresa-usu√°rio
user_sessions          -- Sess√µes ativas
documents              -- Documentos
ai_processing_jobs     -- Jobs de IA
forms                  -- Formul√°rios din√¢micos
calendar_events        -- Eventos de calend√°rio
kanban_boards          -- Quadros kanban
audit_logs             -- Logs de auditoria
```

### MongoDB - Dados Flex√≠veis

```javascript
// Collections principais
system_logs            // Logs do sistema
user_activity_logs     // Atividades dos usu√°rios
api_request_logs       // Logs de API
document_metadata      // Metadados de documentos
ai_processing_results  // Resultados de IA
form_submissions       // Submiss√µes de formul√°rios
dynamic_configurations // Configura√ß√µes din√¢micas
realtime_events        // Eventos em tempo real
usage_analytics        // Analytics de uso
```

### Redis - Cache e Real-time

```bash
# Padr√µes de chaves
session:user:{user_id}              # Sess√µes de usu√°rio
cache:user:{user_id}                # Cache de usu√°rio
rate_limit:user:{user_id}:{endpoint} # Rate limiting
realtime:user:{user_id}:presence    # Presen√ßa online
temp:upload:{upload_id}             # Uploads tempor√°rios
lock:document:{document_id}         # Locks de documento
counter:api_calls:{endpoint}:{date} # Contadores de API
```

## üõ†Ô∏è Comandos de Gerenciamento

### Controle de Servi√ßos

```bash
# Iniciar tudo
./manage_databases.sh start

# Parar tudo
./manage_databases.sh stop

# Reiniciar
./manage_databases.sh restart

# Status dos servi√ßos
./manage_databases.sh status

# Health check completo
./manage_databases.sh health
```

### Backup e Restaura√ß√£o

```bash
# Criar backup completo
./manage_databases.sh backup

# Restaurar do backup mais recente
./manage_databases.sh restore /path/to/backup

# Scripts espec√≠ficos
./frontend/scripts/backup_databases.sh
./frontend/scripts/restore_databases.sh
```

### Manuten√ß√£o

```bash
# Logs em tempo real
./manage_databases.sh logs [service_name]

# Shell interativo dos bancos
./manage_databases.sh shell postgres   # PostgreSQL
./manage_databases.sh shell mongodb    # MongoDB
./manage_databases.sh shell redis      # Redis

# Monitoramento em tempo real
./manage_databases.sh monitor

# Limpeza completa (CUIDADO!)
./manage_databases.sh clean
```
./manage_databases.sh health
```

### Logs e Monitoramento

```bash
# Ver todos os logs
./manage_databases.sh logs

# Logs de um servi√ßo espec√≠fico
./manage_databases.sh logs postgres
./manage_databases.sh logs mongodb
./manage_databases.sh logs redis

# Monitoramento em tempo real
./manage_databases.sh monitor
```

### Backup e Restore

```bash
# Criar backup
./manage_databases.sh backup

# Restaurar backup
./manage_databases.sh restore ./backups/20250530_120000

# Listar backups
ls -la backups/
```

### Shells de Banco

```bash
# PostgreSQL shell
./manage_databases.sh shell postgres

# MongoDB shell
./manage_databases.sh shell mongodb

# Redis shell
./manage_databases.sh shell redis
```

## üìÅ Estrutura de Arquivos

```
‚îú‚îÄ‚îÄ docker-compose.yml              # Configura√ß√£o Docker
‚îú‚îÄ‚îÄ manage_databases.sh             # Script de gerenciamento
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îî‚îÄ‚îÄ DATABASE_DEPLOYMENT.md      # Documenta√ß√£o de deploy
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ init_databases.sh           # Inicializa√ß√£o dos bancos
‚îÇ   ‚îú‚îÄ‚îÄ create_initial_data.py      # Dados iniciais
‚îÇ   ‚îú‚îÄ‚îÄ postgresql_complete_schema.sql # Schema PostgreSQL
‚îÇ   ‚îú‚îÄ‚îÄ mongodb_schemas.js          # Schemas MongoDB
‚îÇ   ‚îî‚îÄ‚îÄ redis_configuration.yml     # Configura√ß√£o Redis
‚îú‚îÄ‚îÄ data/                           # Dados persistentes
‚îÇ   ‚îú‚îÄ‚îÄ postgres/
‚îÇ   ‚îú‚îÄ‚îÄ mongodb/
‚îÇ   ‚îú‚îÄ‚îÄ redis/
‚îÇ   ‚îú‚îÄ‚îÄ grafana/
‚îÇ   ‚îî‚îÄ‚îÄ prometheus/
‚îú‚îÄ‚îÄ backups/                        # Backups autom√°ticos
‚îî‚îÄ‚îÄ logs/                          # Logs da aplica√ß√£o
```

## üîß Configura√ß√£o Avan√ßada

### Desenvolvimento Local

```bash
# Usar vers√£o de desenvolvimento
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up -d

# Executar testes
docker-compose exec postgres python -m pytest tests/

# Debug mode
docker-compose up --no-deps postgres mongodb redis
```

### Produ√ß√£o

```bash
# Deploy para produ√ß√£o
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d

# Configurar SSL/TLS
./scripts/setup_ssl.sh

# Configurar backup autom√°tico
./scripts/setup_cron_backup.sh
```

### Scaling

```bash
# Escalar servi√ßos
docker-compose up -d --scale redis=3

# Configurar cluster MongoDB
./scripts/setup_mongodb_cluster.sh

# Configurar replica√ß√£o PostgreSQL
./scripts/setup_postgres_replica.sh
```

## üìä Monitoramento e Alertas

### M√©tricas Dispon√≠veis

- **Performance**: Tempo de resposta, throughput, lat√™ncia
- **Recursos**: CPU, mem√≥ria, disco, rede
- **Aplica√ß√£o**: Sess√µes ativas, uploads, processamento IA
- **Neg√≥cio**: Usu√°rios ativos, documentos processados, formul√°rios

### Dashboards Grafana

1. **Database Overview**: Vis√£o geral de todos os bancos
2. **PostgreSQL Metrics**: M√©tricas espec√≠ficas do PostgreSQL
3. **MongoDB Analytics**: Analytics do MongoDB
4. **Redis Performance**: Performance do Redis
5. **Application Metrics**: M√©tricas da aplica√ß√£o

### Alertas Configurados

- Uso de mem√≥ria > 80%
- Uso de disco > 85%
- Conex√µes de banco > 90% do limite
- Tempo de resposta > 2 segundos
- Rate limiting atingido
- Falha em backup autom√°tico

## üîê Seguran√ßa

### Configura√ß√µes de Seguran√ßa

```bash
# Configurar SSL/TLS
./scripts/setup_ssl_certificates.sh

# Configurar autentica√ß√£o
./scripts/setup_database_auth.sh

# Configurar firewall
./scripts/setup_firewall_rules.sh

# Rota√ß√£o de senhas
./scripts/rotate_passwords.sh
```

### Auditoria e Compliance

- Todos os acessos s√£o logados
- Mudan√ßas de dados s√£o auditadas
- Backups s√£o criptografados
- Acesso baseado em roles (RBAC)
- Conformidade com LGPD/GDPR

## üß™ Testes

### Testes de Integra√ß√£o

```bash
# Testes dos bancos de dados
docker-compose exec postgres python -m pytest tests/test_databases.py

# Testes de performance
./scripts/run_performance_tests.sh

# Testes de backup/restore
./scripts/test_backup_restore.sh
```

### Carga de Dados de Teste

```python
# Gerar dados de teste
python scripts/generate_test_data.py --records 10000

# Simular carga
python scripts/simulate_load.py --users 100 --duration 600
```

## üö® Troubleshooting

### Problemas Comuns

#### PostgreSQL n√£o inicia
```bash
# Verificar logs
./manage_databases.sh logs postgres

# Verificar permiss√µes
sudo chown -R 999:999 data/postgres

# Verificar configura√ß√£o
docker-compose exec postgres cat /var/lib/postgresql/data/postgresql.conf
```

#### MongoDB sem espa√ßo
```bash
# Verificar uso de disco
df -h data/mongodb

# Compact collections
docker-compose exec mongodb mongosh --eval "db.runCommand({compact: 'collection_name'})"

# Repair database
docker-compose exec mongodb mongosh --eval "db.repairDatabase()"
```

#### Redis mem√≥ria cheia
```bash
# Verificar uso de mem√≥ria
docker-compose exec redis redis-cli INFO memory

# Limpeza manual
docker-compose exec redis redis-cli FLUSHDB

# Ajustar pol√≠tica de mem√≥ria
docker-compose exec redis redis-cli CONFIG SET maxmemory-policy allkeys-lru
```

### Logs de Debug

```bash
# Ativar debug mode
export DEBUG=true
./manage_databases.sh start

# Verificar conectividade
./scripts/test_connectivity.sh

# Verificar performance
./scripts/benchmark_databases.sh
```

## üìö Documenta√ß√£o Adicional

- [üìñ Database Deployment Guide](docs/DATABASE_DEPLOYMENT.md)
- [üîß Configuration Reference](docs/CONFIGURATION.md)
- [üöÄ Performance Tuning](docs/PERFORMANCE.md)
- [üîê Security Guide](docs/SECURITY.md)
- [üìä Monitoring Setup](docs/MONITORING.md)
- [üîÑ Backup Strategy](docs/BACKUP.md)

## ü§ù Contribui√ß√£o

### Como Contribuir

1. Fork o reposit√≥rio
2. Crie uma branch para sua feature (`git checkout -b feature/amazing-feature`)
3. Commit suas mudan√ßas (`git commit -m 'Add some amazing feature'`)
4. Push para a branch (`git push origin feature/amazing-feature`)
5. Abra um Pull Request

### Padr√µes de C√≥digo

- Seguir PEP 8 para Python
- Usar TypeScript para frontend
- Documentar todas as fun√ß√µes
- Testes obrigat√≥rios para novas features
- Seguir padr√µes de commit convencional

## üìû Suporte

### Canais de Suporte

- üìß **Email**: suporte-db@empresa.com
- üí¨ **Slack**: #database-support
- üì± **Telefone**: +55 11 9999-8888 (emerg√™ncias)
- üêõ **Issues**: [GitHub Issues](https://github.com/empresa/multi-database/issues)

### SLA

- **Cr√≠tico**: 1 hora de resposta
- **Alto**: 4 horas de resposta
- **M√©dio**: 24 horas de resposta
- **Baixo**: 72 horas de resposta

## üìÑ Licen√ßa

Este projeto est√° licenciado sob a Licen√ßa MIT - veja o arquivo [LICENSE](LICENSE) para detalhes.

## üèÜ Reconhecimentos

- [PostgreSQL](https://postgresql.org/) - Sistema de banco de dados relacional
- [MongoDB](https://mongodb.com/) - Banco de dados de documentos
- [Redis](https://redis.io/) - Estrutura de dados em mem√≥ria
- [Docker](https://docker.com/) - Plataforma de cont√™ineriza√ß√£o
- [Grafana](https://grafana.com/) - Plataforma de observabilidade

---

**Vers√£o**: 1.0.0  
**√öltima atualiza√ß√£o**: 30 de Maio de 2025  
**Mantido por**: Equipe de Desenvolvimento
#   a p p 0  
 